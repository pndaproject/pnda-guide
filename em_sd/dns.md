# DNS in PNDA

We've decided to use Consul as the base infrastructure component in order to manage endpoints and deliver service discovery feature. We will use its DNS and REST interfaces in order to resolve hosts and service names. 
If you want to have deeper details of the current DNS interface for Consul, check the [Consul DNS documentation](https://www.consul.io/docs/agent/dns.html)
In a PNDA cluster, each nodes include a consul agent, and for pico flavor, a server is available in the kafka instance and for the standard flavor, there is a consul quorum on the zookeeper nodes.

## Overview
![DNS Overview](consul_dns.jpg)


## Usage

As we rely now on Consul for the DNS, following its naming convention, by default, you can access nodes using the scheme:

```
<hostname>.node<.datacenter>.domain
```

and services as:

```
<servicename>.service<.datacenter>.domain
```

We are updating the DNS configuration on each PNDA cluster nodes by adding in resolv.conf the nameserver which is the IP where the server instance of Consul is running and the search domain as node.dc1.pnda.local. Here is a sample configuration:

```
[root@pnda-guide-14371-kafka-0 ec2-user]# cat /etc/resolv.conf
nameserver 10.0.1.98
# Generated by NetworkManager
search eu-west-1.compute.internal node.dc1.pnda.local
nameserver 10.0.0.2
```

So then if you want to access a node by hostname, this is be automatically resolved by Consul:

```
[root@pnda-guide-14371-bastion ec2-user]# ping pnda-guide-14371-kafka-0
PING pnda-guide-14371-kafka-0.node.dc1.pnda.local (10.0.1.98) 56(84) bytes of data.
```

If you want to access a service:

```
[root@pnda-guide-14371-bastion ec2-user]# ping zookeeper.service.dc1.pnda.local
PING zookeeper.service.dc1.pnda.local (10.0.1.98) 56(84) bytes of data.
```

Also as mentionned previously, you can also use the Consul UI, on the node tab, in order to have the cluster topology:
![Consul UI](consul_nodes.jpeg)
